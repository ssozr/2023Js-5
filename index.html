<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/c3/0.7.18/c3.css">
    <link rel="stylesheet" href="./stylesheets/all.css">
    
</head>
<body>
    <div class="container my-45">
        <div class="row d-flex justify-content-center">
          <div class="col-10 d-flex justify-content-center border border-shadow border-top-0">
            <div class="col-8 d-flex justify-content-center py-15 ">
              <div class="col-6">
                <img src="https://github.com/hexschool/2022-web-layout-training/blob/main/js_week5/main_img.png?raw=true" alt="" class="h-250 mb-a11">
                <h1>
                  <img src="https://github.com/hexschool/2022-web-layout-training/blob/main/js_week5/logo.png?raw=true" class="h-235" alt="">
                </h1>
              </div>
              <div class="col-6">
                <h2 class="fw-bold fs-24 text-primary border-bottom border-3 border-primary d-flex align-items-center pb-1 mb-10"><span class="material-symbols-outlined pe-a6">
                    add_circle
                  </span>新增旅遊套票</h2>
                <form>
                  <div class="mb-6 d-flex align-items-center">
                    <label for="addName" class="form-label text-nowrap text-primary m-0 fw-medium">套票名稱</label>
                    <input type="text" class="form-control border-0  border-bottom border-2 border-primary rounded-0 ms-31 input-FAFAFA py-2 px-3" id="addName" placeholder="請填寫套票名稱" aria-describedby="emailHelp">
                  </div>
                  <div class="mb-6 d-flex align-items-center">
                    <label for="addImage" class="form-label text-nowrap text-primary m-0 fw-medium">圖片網址</label>
                    <input type="text" class="form-control border-0  border-bottom border-2 border-primary rounded-0 ms-31 input-FAFAFA py-2 px-3" id="addImage" placeholder="請填寫圖片網址" aria-describedby="emailHelp">
                  </div>
                  <div class="mb-6 d-flex align-items-center">
                    <label for="addArea" class="form-label text-nowrap text-primary m-0 fw-medium">景點地區</label>
                    <select id="addArea" class=" py-2 px-3 w-100 border-0  border-bottom border-2 border-primary rounded-0 ms-31 input-FAFAFA text-818A91" name="景點地區">
                      <option value="">請選擇景點地區</option>
                      <option value="台北">台北</option>
                      <option value="台中">台中</option>
                      <option value="高雄">高雄</option>
                    </select>
                  </div>
                  <div class="mb-6 d-flex align-items-center">
                    <label for="addPrice" class="form-label text-nowrap text-primary m-0 fw-medium">套票金額</label>
                    <input type="number" class="form-control border-0  border-bottom border-2 border-primary rounded-0 ms-31 input-FAFAFA py-2 px-3" id="addPrice" placeholder="請填寫套票金額" aria-describedby="emailHelp">
                  </div>
                  <div class="mb-6 d-flex align-items-center">
                    <label for="addTicketRemainder " class="form-label text-nowrap text-primary m-0 fw-medium">套票組數</label>
                    <input type="number" class="form-control border-0  border-bottom border-2 border-primary rounded-0 ms-31 input-FAFAFA py-2 px-3" id="addTicketRemainder" placeholder="請填寫套票組數" aria-describedby="emailHelp">
                  </div>
                  <div class="mb-6 d-flex align-items-center">
                    <label for="addStar" class="form-label text-nowrap text-primary m-0 fw-medium">套票星級</label>
                    <select id="addStar" class=" py-2 px-3 w-100 border-0  border-bottom border-2 border-primary rounded-0 ms-31 input-FAFAFA text-818A91" name="套票星級">
                      <option value="1">1</option>
                      <option value="2">2</option>
                      <option value="3">3</option>
                      <option value="4">4</option>
                      <option value="5">5</option>
                      <option value="6">6</option>
                      <option value="7">7</option>
                      <option value="8">8</option>
                      <option value="9">9</option>
                      <option value="10">10</option>
                    </select>
                  </div>
                  <div class="mb-6 d-flex">
                    <label for="ticketDescription" class="form-label text-nowrap text-primary m-0 fw-medium">套票描述</label>
                    <textarea type="text" class="form-control  border-0 border-bottom border-2 border-primary rounded-0 ms-31 pt-0 input-FAFAFA " id="ticketDescription" placeholder="請填寫套票描述（限 100 字）" aria-describedby="emailHelp"></textarea>
                  </div>
                  <div class="text-end">
                    <button type="button" class="btn bg-primary py-a10 px-10 text-white fw-medium" id="addButton">新增套票</button>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>
    </div>
    <div class="container-fulid bg-F7F7F7 pt-16 pb-45">
      <div class="container">
        <div class="row">
            <div class="col-10 offset-1">
              <div class="d-flex align-items-start justify-content-between">
                <div class="d-flex col-8 align-items-center">
                  <div class="mb-3 me-a30 col-5">
                    <select class="form-select filter" id="inputGroupSelect01">
                      <option selected>全部地區</option>
                      <option value="高雄">高雄</option>
                      <option value="台北">台北</option>
                      <option value="台中">台中</option>
                    </select>
                  </div>
                  <h3 class=" fs-16 text-818A91 searchNum">本次搜尋共 6 筆資料</h3>
                </div>
                <div class="col-3 d-flex justify-content-center align-items-end">
                  <div id="chart"></div>
                </div>
              </div>
            </div>
            <div class="row row-cols-1 row-cols-md-3 g-4 list">
              <div class="col">
                <div class="card h-100">
                  <div class="position-relative">
                    <div class="position-absolute translate-middle-y top-0 start-0 bg-secondary">
                      <p class="m-0 px-5 py-3 text-white fs-5">台北</p>
                    </div>
                    <img src="https://github.com/hexschool/2022-web-layout-training/blob/main/js_week5/travel_1.png?raw=true  " class="card-img-top" alt="...">
                    <div class="position-absolute  bottom-0 transform-0-50 start-0 bg-primary">
                      <p class="m-0 px-2 py-a5 text-white fs-16">8.6</p>
                    </div>
                  </div>
                  <div class="card-body p-5 mb-3">
                    <h5 class="card-title fs-24 text-primary border-bottom border-2 border-primary mb-4">綠島自由行套裝行程</h5>
                    <p class="card-text text-818A91">嚴選超高CP值綠島自由行套裝行程，多種綠島套裝組合，提供台東綠島來回船票、綠島環島機車、綠島民宿住宿，行程加贈『綠島浮潛體驗』以及『綠島生態導覽』，讓你用輕鬆的綠島套裝自由行，也能深度認識綠島在地文化。</p>
                  </div>
                  <div class="card-footer border-0 bg-white pb-a25">
                    <div class="d-flex justify-content-between align-items-center">
                      <p class="mb-0 fs-16 text-primary d-flex align-items-center"><span class="material-symbols-outlined bg-primary text-white rounded-circle me-a6">
                        exclamation
                        </span>剩下最後 8 組</p>
                      <p class="mb-0 fs-16 text-primary d-flex align-items-center">TWD<span class="ms-1 fs-32">$1,280</span></p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
        </div>
      </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/axios@1.1.2/dist/axios.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/5.16.0/d3.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/c3/0.7.18/c3.js"></script>
    <script>
      let data = []
      const list = document.querySelector(".list")
      const filter = document.querySelector(".filter")
      const searchNum = document.querySelector(".searchNum")
      
      //新增套票
      const addButton = document.querySelector("#addButton")
      const addName = document.getElementById('addName');
      const addImage = document.getElementById('addImage');
      const addArea = document.getElementById('addArea');
      const addPrice = document.getElementById('addPrice');

      axios.get('https://raw.githubusercontent.com/hexschool/js-training/main/travelApi.json')
        .then(function (response) {
          // handle success
          data = response.data.data
          chartData(data);
          init();
        })
        .catch(function (error) {
          // handle error
          console.log(error);
        });
      
      addButton.addEventListener("click",function(e){
        let addObj ={}
        console.log(data.length)
        if(!addName.value || !addImage.value || !addPrice.value || !addTicketRemainder.value || !addStar.value || !ticketDescription.value || !addArea.value){
          alert("請填寫完全")
          return
        }
        addObj =  {
          "id": data.length,
          "name": addName.value,
          "imgUrl": addImage.value,
          "area": addArea.value,
          "description": ticketDescription.value,
          "group": addTicketRemainder.value,
          "price": addPrice.value,
          "rate": addStar.value
        }
        data.push(addObj)
        chartData(data);
        init();
        addName.value=""
        addImage.value=""
        ticketDescription.value=""
        addTicketRemainder.value=""
        addPrice.value=""
        addStar.value=""
        addArea.value=""
      })
      //圖表
      function chartData(data) {
        let totalObject = {};
        data.forEach(function (item) {
          if (totalObject[item.area] === undefined) {
            totalObject[item.area] = 1;
          } else {
            totalObject[item.area]++;
          }
        });
        let newData = [];
        let area = Object.keys(totalObject);
        area.forEach(function (item, index) {
          let ary = [];
          ary.push(item);
          ary.push(totalObject[item]);
          newData.push(ary);
        });
        chartf(newData)
      }
      function chartf(data){
        const chart = c3.generate({
        data: {
          // iris data from R
          columns: data,
          type: "donut",
        },
        donut: {
          title: "套票地區比重",
          label: {
            format: function (value, ratio, id) {
                return "";  // 將標籤格式設置為空字符串
            }
          },
          width: 10,
        },
        size: {
        width: 160,  // 設置寬度
        height: 205  // 設置高度
        },
      });
      }
        
      //旅遊列表
      function html(item){
        return `<div class="col mb-a38">
                <div class="card h-100">
                  <div class="position-relative">
                    <div class="position-absolute translate-middle-y top-0 start-0 bg-secondary">
                      <p class="m-0 px-5 py-3 text-white fs-5">${item.area}</p>
                    </div>
                    <img src=${item.imgUrl} class="card-img-top img-fluid" alt="...">
                    <div class="position-absolute  bottom-0 transform-0-50 start-0 bg-primary">
                      <p class="m-0 px-2 py-a5 text-white fs-16">${item.rate}</p>
                    </div>
                  </div>
                  <div class="card-body p-5 mb-3">
                    <h5 class="card-title fs-24 text-primary border-bottom border-2 border-primary mb-4 fw-medium">${item.name}</h5>
                    <p class="card-text text-818A91">${item.description}</p>
                  </div>
                  <div class="card-footer border-0 bg-white pb-a25">
                    <div class="d-flex justify-content-between align-items-center">
                      <p class="mb-0 fs-16 text-primary d-flex align-items-center"><span class="material-symbols-outlined bg-primary text-white rounded-circle me-a6">
                        exclamation
                        </span>剩下最後 ${item.group} 組</p>
                      <p class="mb-0 fs-16 text-primary d-flex align-items-center">TWD<span class="ms-1 fs-32">$${item.price}</span></p>
                    </div>
                  </div>
                </div>
              </div>`
      }
      function init(){
        let str ="";
        data.forEach(function(item){
          str += html(item)
        })
         list.innerHTML = str;
         searchNum.innerHTML = `本次搜尋共 ${data.length} 筆資料`
      }
      filter.addEventListener("change",function(e){
        let address = e.target.value
        let str = "";
        let num = 0;
        data.forEach(function(item){
          if(address === item.area){
            str += html(item)
            num++
          }else if(address === "全部地區"){
            str += html(item)
            num = data.length
          }
        })
        list.innerHTML = str;
        searchNum.innerHTML = `本次搜尋共 ${num} 筆資料`
      })
      

    </script>
</body>
</html>c